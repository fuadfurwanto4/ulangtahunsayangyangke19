<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChelseaOS v20.07 ğŸ€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <!-- FIREBASE (JANGAN DIHAPUS - INI BUAT KIRIM PESAN KE INBOX) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // --- PENTING: GANTI INI DENGAN KODE DARI FIREBASE CONSOLE KAMU ---
        const firebaseConfig = {
            apiKey: "ISI_API_KEY_DISINI",
            authDomain: "ISI_AUTH_DOMAIN_DISINI",
            projectId: "ISI_PROJECT_ID_DISINI",
            storageBucket: "ISI_STORAGE_BUCKET_DISINI",
            messagingSenderId: "ISI_SENDER_ID_DISINI",
            appId: "ISI_APP_ID_DISINI"
        };
        // -----------------------------------------------------------------

        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("Database Connected");
        } catch (e) {
            console.log("Firebase config belum diisi");
        }

        window.kirimPesanKeInbox = async function() {
            const pesan = document.getElementById('wa-input').value;
            const btn = document.getElementById('btn-kirim');
            
            if(!pesan) { alert("Isi pesannya dulu dong sayang! ğŸ˜œ"); return; }
            
            btn.innerText = "Mengirim...";
            btn.disabled = true;

            try {
                if(db) {
                    await addDoc(collection(db, "inbox_chelsea"), {
                        pesan: pesan,
                        waktu: new Date().toLocaleString()
                    });
                    alert("Pesan berhasil dikirim ke Inbox Mamas! â¤ï¸");
                    document.getElementById('wa-input').value = "";
                    closeWindow('win-msg-mamas');
                } else {
                    alert("Database belum disetting. Pesan tidak terkirim. (Hubungi Mas Fuad)");
                }
            } catch (e) {
                alert("Gagal kirim. Cek koneksi internet ya.");
                console.error(e);
            }
            btn.innerText = "KIRIM KE INBOX";
            btn.disabled = false;
        }
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 'win-gray': '#c0c0c0', 'win-blue': '#000080', 'chelsea-pink': '#ffc0cb', 'deep-purple': '#4a0e4e' },
                    fontFamily: { 'pixel': ['"VT323"', 'monospace'], 'body': ['"Quicksand"', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        .win-box { background-color: #c0c0c0; border-top: 2px solid #fff; border-left: 2px solid #fff; border-right: 2px solid #808080; border-bottom: 2px solid #808080; box-shadow: 1px 1px 0 #000; }
        .win-box-inset { background-color: #fff; border-top: 2px solid #808080; border-left: 2px solid #808080; border-right: 2px solid #fff; border-bottom: 2px solid #fff; }
        .win-header { background: linear-gradient(90deg, #ff1493, #ff69b4); color: white; padding: 2px 4px; font-family: 'Quicksand', sans-serif; font-weight: bold; display: flex; align-items: center; justify-content: space-between; }
        .win-btn { background: #c0c0c0; border-top: 1px solid #fff; border-left: 1px solid #fff; border-right: 1px solid #000; border-bottom: 1px solid #000; min-width: 20px; text-align: center; cursor: pointer; font-size: 12px; line-height: 14px; }
        .win-btn:active { border-top: 1px solid #000; border-left: 1px solid #000; border-right: 1px solid #fff; border-bottom: 1px solid #fff; }
        .desktop-icon { width: 80px; display: flex; flex-direction: column; align-items: center; text-align: center; cursor: pointer; padding: 5px; border: 1px solid transparent; margin-bottom: 5px; }
        .desktop-icon:hover { border: 1px dotted white; background: rgba(255, 255, 255, 0.2); }
        .desktop-icon img { width: 48px; height: 48px; margin-bottom: 4px; filter: drop-shadow(2px 2px 0 rgba(0,0,0,0.3)); }
        .icon-label { color: white; font-family: 'Quicksand', sans-serif; font-size: 11px; text-shadow: 1px 1px 2px black; background: rgba(0,0,0,0.2); padding: 2px 4px; border-radius: 4px; line-height: 1.2; }
        
        /* Force hidden by default */
        .window { position: absolute; display: none !important; flex-direction: column; resize: both; overflow: hidden; min-width: 200px; min-height: 150px; animation: popUp 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .window.active { display: flex !important; z-index: 50; }
        @keyframes popUp { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        #boot-screen { font-family: 'VT323', monospace; background: black; color: #00ff00; z-index: 9999; }
        .typing-cursor::after { content: 'â–ˆ'; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        #taskbar { background: #c0c0c0; border-top: 2px solid #fff; box-shadow: 0 -2px 2px rgba(0,0,0,0.1); }
        .scanlines { background: linear-gradient( to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1) ); background-size: 100% 4px; position: fixed; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 9998; opacity: 0.3; }
        
        .cake-container { position: relative; width: 250px; height: 150px; background: #ffc0cb; border-radius: 10px 10px 0 0; display: flex; justify-content: space-around; align-items: flex-end; padding-bottom: 20px; border-bottom: 10px solid #d45d79; }
        .candle { width: 15px; height: 60px; background: repeating-linear-gradient(45deg, #fff, #fff 5px, #ff69b4 5px, #ff69b4 10px); position: relative; border-radius: 3px; }
        .flame { width: 20px; height: 30px; background: radial-gradient(ellipse at bottom, #ffee00, #ff9900, #ff0000); border-radius: 50% 50% 20% 20%; position: absolute; top: -35px; left: 50%; transform: translateX(-50%); animation: flicker 0.5s infinite alternate; cursor: pointer; box-shadow: 0 0 10px #ff9900; transition: opacity 0.3s; }
        .flame.off { opacity: 0; animation: none; }
        .smoke { position: absolute; top: -40px; left: 50%; width: 10px; height: 20px; background: rgba(200,200,200,0.5); border-radius: 50%; filter: blur(3px); opacity: 0; transform: translateX(-50%); }
        .smoke.active { animation: smokeRise 1s forwards; }
        @keyframes flicker { 0% { transform: translateX(-50%) scale(1); opacity: 1; } 100% { transform: translateX(-50%) scale(1.1); opacity: 0.8; } }
        @keyframes smokeRise { 0% { opacity: 0.8; top: -35px; } 100% { opacity: 0; top: -80px; transform: translateX(-50%) scale(2); } }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: #f1f1f1; } ::-webkit-scrollbar-thumb { background: #888; }
        @media (max-width: 640px) { .window { width: 90% !important; left: 5% !important; top: 5% !important; max-height: 80vh; } }
    </style>
</head>
<body class="overflow-hidden bg-[#008080] h-screen select-none">
    
    <audio id="bg-music" loop>
        <source src="https://audio.jukehost.co.uk/vdoQtXrOwDkIV71BKmp7Cqxo6brez5HF" type="audio/mpeg">
    </audio>

    <div class="scanlines"></div>

    <div id="boot-screen" class="fixed inset-0 flex flex-col justify-center items-center p-8 text-xl leading-relaxed cursor-pointer" onclick="bootSystem()">
        <div class="max-w-2xl w-full">
            <p class="mb-2">BIOS Date 01/24/26 11:04:00 Ver: 20.07</p>
            <p class="mb-2">CPU: Love Core i9-9999K @ 5.0GHz</p>
            <p class="mb-4">Memory Test: 1048576K OK</p>
            <div id="boot-text" class="text-white space-y-1"></div>
            <div id="click-prompt" class="mt-8 text-center hidden animate-pulse text-yellow-400">[ KLIK LAYAR UNTUK MASUK KE SYSTEM ]</div>
        </div>
    </div>

    <div id="login-screen" class="fixed inset-0 bg-[#000080] hidden z-[60] flex flex-col justify-center items-center">
        <div class="win-box p-1 bg-[#c0c0c0] rounded-sm">
            <div class="win-header mb-4"><span>Welcome to ChelseaOS</span></div>
            <div class="flex gap-6 p-6 items-center">
                <div class="w-24 h-24 bg-white border-2 border-gray-500 p-1"><img src="https://i.pinimg.com/564x/c9/22/68/c92268d92cf2dbf96e3195683d9d3af9.jpg" class="w-full h-full object-cover"></div>
                <div class="flex flex-col gap-3">
                    <h2 class="text-xl font-bold font-body">Chealsea R.C.</h2>
                    <p class="text-sm text-gray-600">Type your password to log on</p>
                    <div class="flex flex-col gap-2">
                        <input type="password" id="login-pass" placeholder="Masukan password disini" class="win-box-inset px-2 py-1 w-64 bg-white focus:outline-none font-body text-sm">
                        <button onclick="checkLogin()" class="win-btn px-4 py-1 font-bold active:translate-y-px bg-green-200 self-start">â¡ï¸ MASUK</button>
                    </div>
                    <p id="login-error" class="text-red-500 text-xs font-bold hidden bg-white px-1 mt-1">Password Salah! Coba lagi sayang :p</p>
                </div>
            </div>
        </div>
    </div>

    <main id="desktop" class="relative w-full h-full hidden bg-cover bg-center" style="background-image: url('https://i.pinimg.com/originals/91/92/2e/91922e37905f0d57d77b814a0f44358a.gif');">
        <div class="absolute top-4 left-4 grid grid-cols-2 gap-x-4 gap-y-2 w-[180px]">
            <div class="desktop-icon" onclick="openWindow('win-letter')"><img src="https://cdn-icons-png.flaticon.com/512/3033/3033143.png"><span class="icon-label">SuratCinta.txt</span></div>
            <div class="desktop-icon" onclick="openWindow('win-gallery')"><img src="https://cdn-icons-png.flaticon.com/512/3342/3342137.png"><span class="icon-label">FotoKita_HD</span></div>
            <div class="desktop-icon" onclick="openWindow('win-music')"><img src="https://cdn-icons-png.flaticon.com/512/3039/3039437.png"><span class="icon-label">Playlist.mp3</span></div>
            <div class="desktop-icon" onclick="openWindow('win-cake')"><img src="https://cdn-icons-png.flaticon.com/512/3362/3362720.png"><span class="icon-label">KueUltah.exe</span></div>
            <div class="desktop-icon" onclick="openWindow('win-diary')"><img src="https://cdn-icons-png.flaticon.com/512/2904/2904859.png"><span class="icon-label">MyDiary.exe</span></div>
            <div class="desktop-icon" onclick="openWindow('win-msg-mamas')"><img src="https://cdn-icons-png.flaticon.com/512/2165/2165061.png"><span class="icon-label">ToMamas.exe</span></div>
            <div class="desktop-icon" onclick="openWindow('win-game')"><img src="https://cdn-icons-png.flaticon.com/512/808/808476.png"><span class="icon-label">MagicCandle.exe</span></div>
            <div class="desktop-icon" onclick="openWindow('win-video')"><img src="https://cdn-icons-png.flaticon.com/512/2859/2859706.png"><span class="icon-label">Cinema.mp4</span></div>
            <div class="desktop-icon" onclick="openWindow('win-calc')"><img src="https://cdn-icons-png.flaticon.com/512/564/564429.png"><span class="icon-label">HitungCinta</span></div>
            <div class="desktop-icon" onclick="openWindow('win-error')"><img src="https://cdn-icons-png.flaticon.com/512/3342/3342176.png"><span class="icon-label">Mantan</span></div>
        </div>

        <!-- Windows -->
        <div id="win-letter" class="window win-box w-[500px] h-[400px] top-10 left-[220px]" style="display: none;">
            <div class="win-header" onmousedown="dragStart(event, 'win-letter')"><span>ğŸ“ SuratCinta.txt</span><button class="win-btn" onclick="closeWindow('win-letter')">X</button></div>
            <div class="flex-1 win-box-inset m-1 p-4 overflow-y-auto font-pixel text-lg bg-white leading-6">
                <p>Halo sayang!!!!! ğŸ˜‡ğŸ˜‡</p><p>bagaimana bisa masuk kan??????? ğŸ˜ğŸ˜ğŸ˜</p><br>
                <p>alhamdulillah .. Lihat lihat!!!!! ada yang berumur 19 tahun sekarang !!!!ğŸ¤©ğŸ¤©ğŸ¤©</p>
                <p>Pertama-tama mas cuma mau ucapin selamat ulang tahun yang ke-19 tahun ya sayang ğŸ‰ğŸ‚ğŸ€ğŸ’—ğŸ¥³ semoga Panjang umur, di sehatkan badannya, di mudahkan segala urusannya...</p><br>
                <p class="text-xl text-chelsea-pink font-body">ğ»ğ’¶ğ“…ğ“…ğ“ ğ’·ğ’¾ğ“‡ğ“‰ğ’½ğ’¹ğ’¶ğ“</p><br>
                <p>Di tanggal 23 Februari 2007 lahir lah seorang bayi perempuan bernama CHEALSEA REGITA CAHYANI ğŸ‘¶ğŸ»...</p>
                <p>I LOVEE YOUUU SO MUCHHH SAYANG MAMASSSSS .. sehat sehat terus ya cantik ğŸ«¶ğŸ»ğŸ¥¹â¤ï¸â€ğŸ©¹</p>
            </div>
        </div>

        <div id="win-diary" class="window win-box w-[400px] h-[350px] top-20 left-[250px]" style="display: none;">
            <div class="win-header" onmousedown="dragStart(event, 'win-diary')"><span>ğŸ“” Diary Rahasia</span><button class="win-btn" onclick="closeWindow('win-diary')">X</button></div>
            <div class="flex-1 p-2 bg-[#f0f0f0] flex flex-col">
                <p class="text-sm mb-2 font-bold text-gray-600">Harapan untuk Diri Sendiri:</p>
                <textarea id="diary-input" class="flex-1 w-full p-2 border-2 border-gray-400 font-body text-sm resize-none focus:outline-none"></textarea>
                <div class="mt-2 flex justify-between items-center"><button onclick="saveDiary()" class="win-btn px-3 py-1 bg-blue-200 font-bold">ğŸ’¾ SIMPAN</button><span class="text-xs text-gray-500 italic">*Mamas tidak akan tahu</span></div>
            </div>
        </div>

        <div id="win-msg-mamas" class="window win-box w-[400px] h-[300px] top-32 left-[280px]" style="display: none;">
            <div class="win-header" onmousedown="dragStart(event, 'win-msg-mamas')"><span>ğŸ’Œ Pesan Untuk Mamas</span><button class="win-btn" onclick="closeWindow('win-msg-mamas')">X</button></div>
            <div class="flex-1 p-2 bg-[#f0f0f0] flex flex-col">
                <p class="text-sm mb-2 font-bold text-gray-600">Tulis pesan buat Mas Fuad:</p>
                <textarea id="wa-input" class="flex-1 w-full p-2 border-2 border-gray-400 font-body text-sm resize-none focus:outline-none" placeholder="Mas Fuad, aku mau bilang..."></textarea>
                <div class="mt-2 flex justify-between items-center">
                    <button id="btn-kirim" onclick="kirimPesanKeInbox()" class="win-btn px-3 py-1 bg-green-200 font-bold text-green-900">KIRIM KE INBOX</button>
                    <span class="text-xs text-gray-500 italic">*Terkirim ke Inbox.html</span>
                </div>
            </div>
        </div>

        <div id="win-game" class="window win-box w-[450px] h-[450px] top-10 right-10" style="display: none;">
            <div class="win-header" onmousedown="dragStart(event, 'win-game')"><span>ğŸ•¯ï¸ Magic Candle</span><button class="win-btn" onclick="closeWindow('win-game')">X</button></div>
            <div class="flex-1 bg-black relative flex flex-col items-center justify-center p-4">
                <div class="absolute top-2 right-2"><button onclick="enableMic()" class="bg-gray-800 text-white text-xs px-2 py-1 rounded">ğŸ¤ Mic</button></div>
                <div class="cake-container mt-10" id="candle-container"></div>
                <div class="mt-8 text-white text-center font-pixel text-lg z-10"><p id="game-instruction">Tiup/Klik api!</p></div>
                <button id="reset-candle-btn" onclick="resetCandles()" class="hidden mt-4 bg-yellow-400 text-black px-4 py-2 font-bold rounded animate-bounce">Main Lagi?</button>
            </div>
        </div>

        <div id="win-video" class="window win-box w-[500px] top-[15%] left-[20%]" style="display: none;">
            <div class="win-header" onmousedown="dragStart(event, 'win-video')"><span>ğŸ¬ Cinema</span><button class="win-btn" onclick="closeWindow('win-video')">X</button></div>
            <div class="bg-black p-1 flex items-center justify-center"><video class="w-full h-[280px]" controls><source src="video_kita.mp4" type="video/mp4"></video></div>
        </div>

        <div id="win-gallery" class="window win-box w-[500px] top-20 left-40" style="display: none;">
             <div class="win-header" onmousedown="dragStart(event, 'win-gallery')"><span>ğŸ“¸ Memories</span><button class="win-btn" onclick="closeWindow('win-gallery')">X</button></div>
             <div id="gallery-content" class="flex-1 bg-white m-1 p-2 grid grid-cols-2 gap-2 overflow-y-auto max-h-[400px]"></div>
        </div>
        
        <div id="win-image-viewer" class="window win-box w-[500px] top-10 left-10 z-[70]" style="display: none;">
            <div class="win-header" onmousedown="dragStart(event, 'win-image-viewer')"><span>ğŸ–¼ï¸ Viewer</span><button class="win-btn" onclick="closeWindow('win-image-viewer')">X</button></div>
            <div class="flex-1 bg-white m-1 p-2 flex flex-col items-center"><img id="viewer-img" class="w-full max-h-[300px] object-contain mb-4 bg-black"><div class="w-full bg-pink-50 p-4 rounded"><p class="font-bold text-xs">Mas Fuad says:</p><p id="viewer-caption" class="text-sm italic"></p></div></div>
        </div>

        <div id="win-calc" class="window win-box w-[300px] top-[40%] right-[20%]" style="display: none;"><div class="win-header" onmousedown="dragStart(event, 'win-calc')"><span>ğŸ§® Calculator</span><button class="win-btn" onclick="closeWindow('win-calc')">X</button></div><div class="p-4 bg-white font-pixel text-lg"><p>Age: <span id="age-calc" class="text-blue-600">...</span></p><hr class="my-2"><p>Days: <span id="days-calc" class="text-pink-600">...</span></p></div></div>
        <div id="win-error" class="window win-box w-[300px] top-[40%] left-[40%] z-[999]" style="display: none;"><div class="win-header" onmousedown="dragStart(event, 'win-error')"><span>âš ï¸ Error</span><button class="win-btn" onclick="closeWindow('win-error')">X</button></div><div class="p-4 bg-[#c0c0c0] flex items-center gap-4"><img src="https://cdn-icons-png.flaticon.com/512/3342/3342176.png" class="w-10"><div><p class="font-bold text-sm">Access Denied!</p><p class="text-xs">Kenangan buruk dilarang! ğŸ˜œ</p></div></div><div class="p-2 flex justify-center bg-[#c0c0c0]"><button class="win-btn px-4 font-bold" onclick="closeWindow('win-error')">OK</button></div></div>

        <!-- Music & Cake (Hidden by CSS, Shown by JS) -->
        <div id="win-music" class="window win-box w-[300px] top-[40%] right-[5%]" style="display: none;">
            <div class="win-header" onmousedown="dragStart(event, 'win-music')"><span>ğŸµ WinAmp</span><button class="win-btn" onclick="closeWindow('win-music')">X</button></div>
            <div class="bg-black p-4 m-1 win-box-inset text-white"><marquee>NOW PLAYING: Happy Birthday to Chelsea</marquee><div class="flex justify-center gap-2 mt-2"><button onclick="document.getElementById('bg-music').play()" class="win-btn font-bold">â–¶</button><button onclick="document.getElementById('bg-music').pause()" class="win-btn font-bold">â¸</button></div></div>
        </div>

        <div id="win-cake" class="window win-box w-[350px] top-[15%] left-[30%]" style="display: none;">
            <div class="win-header" onmousedown="dragStart(event, 'win-cake')"><span>ğŸ‚ Make a Wish!</span><button class="win-btn" onclick="closeWindow('win-cake')">X</button></div>
            <div class="p-6 bg-pink-100 text-center m-1 win-box-inset relative overflow-hidden"><div class="text-6xl mb-2 cursor-pointer transition transform hover:scale-105" onclick="blowCandleGeneric()">ğŸ‚</div><p id="wish-text" class="hidden mt-4 text-sm font-body">"Semoga panjang umur!" ğŸ‰</p></div>
        </div>

        <div id="taskbar" class="absolute bottom-0 w-full h-10 flex items-center px-2 gap-2 z-[100]"><button class="win-btn px-2 py-1 flex items-center gap-2 font-bold text-lg" onclick="alert('Menu Start Coming Soon!')"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e2/Windows_logo_and_wordmark_-_1995-2001.svg/1200px-Windows_logo_and_wordmark_-_1995-2001.svg.png" class="h-4"> Start</button><div class="ml-auto win-box-inset px-3 py-1 bg-[#c0c0c0] text-xs font-pixel"><span id="clock">12:00</span></div></div>
    </main>

    <script>
        const bootText = ["Initializing Heart...", "Loading Memories...", "Checking Cuteness...", "Starting ChelseaOS...", "Ready."];
        let lineIdx = 0;
        window.onload = () => {
            const type = () => {
                if (lineIdx < bootText.length) {
                    const p = document.createElement('p'); p.textContent = "> " + bootText[lineIdx++]; p.className = "typing-cursor mb-1";
                    document.getElementById('boot-text').appendChild(p);
                    if(lineIdx>1) document.getElementById('boot-text').children[lineIdx-2].classList.remove('typing-cursor');
                    setTimeout(type, 500);
                } else document.getElementById('click-prompt').classList.remove('hidden');
            }; type();

            // INIT GALLERY (8 FOTO)
            const photos = [
                {src:'https://i.pinimg.com/564x/2a/3a/0a/2a3a0a3d463868270525287515d4872c.jpg', msg:'Ini foto kamu pas masih kecil. Lucu banget sih! ğŸ¥°', name:'Little_Angel.jpg'},
                {src:'https://i.pinimg.com/564x/4a/01/f9/4a01f9d51025595958742884a4448261.jpg', msg:'Pas jalan berdua. â¤ï¸', name:'Us_Moment.jpg'},
                {src:'https://i.pinimg.com/564x/7e/e4/24/7ee4241e73f4e389e78297054f056f71.jpg', msg:'Ketawa lepas!', name:'Happy.jpg'},
                {src:'https://i.pinimg.com/564x/a4/0c/36/a40c36b6d5106173730e2007887756f7.jpg', msg:'Cantik banget.', name:'Beautiful.jpg'},
                {src:'https://i.pinimg.com/564x/c9/22/68/c92268d92cf2dbf96e3195683d9d3af9.jpg', msg:'Kangen kamu.', name:'Miss_U.jpg'},
                {src:'https://i.pinimg.com/564x/d8/9f/fa/d89ffa36070a72097e3a95610815e347.jpg', msg:'Cubittt!', name:'Baby_C.jpg'},
                {src:'https://i.pinimg.com/564x/bd/6d/2c/bd6d2cb134608c02c6596950486c8724.jpg', msg:'Wanita hebat.', name:'Grow.jpg'},
                {src:'https://i.pinimg.com/564x/4a/01/f9/4a01f9d51025595958742884a4448261.jpg', msg:'Forever.', name:'Forever.jpg'}
            ];
            document.getElementById('gallery-content').innerHTML = photos.map(p => `<div class="win-box p-2 bg-gray-100 text-center cursor-pointer hover:bg-blue-100 transition" onclick="openPhoto('${p.src}', '${p.msg}')"><img src="${p.src}" class="w-full h-40 object-cover border-2 border-gray-300 pointer-events-none"><p class="font-pixel mt-1">${p.name}</p></div>`).join('');

            // INIT CANDLES
            document.getElementById('candle-container').innerHTML = Array(5).fill(0).map((_,i) => `<div class="candle" id="c${i+1}"><div class="flame" onclick="blowCandle(${i+1})"></div><div class="smoke"></div></div>`).join('');
        };

        function bootSystem() {
            document.documentElement.requestFullscreen().catch(e=>{});
            document.getElementById('boot-screen').style.display = 'none';
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('login-screen').classList.add('flex');
        }

        function checkLogin() {
            if(document.getElementById('login-pass').value.toLowerCase().trim() === "cece cantik") {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('desktop').classList.remove('hidden');
                document.getElementById('desktop').classList.add('block');
                
                // --- FIX: CUMA BUKA MUSIK & KUE ---
                // Pastikan yang lain tertutup
                const allWindows = document.querySelectorAll('.window');
                allWindows.forEach(w => w.style.setProperty('display', 'none', 'important'));

                // Buka yang diperlukan
                setTimeout(() => openWindow('win-music'), 500); 
                setTimeout(() => openWindow('win-cake'), 1000);
                
                try { document.getElementById('bg-music').play(); } catch(e){}
                setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}), 1000);
                
                // Calc Age
                const diff = new Date() - new Date('2007-02-23');
                document.getElementById('age-calc').innerText = Math.floor(diff / 31557600000) + " Years";
                document.getElementById('days-calc').innerText = Math.floor(diff / 86400000) + " Days";
                
                if(localStorage.getItem('chelsea_diary')) document.getElementById('diary-input').value = localStorage.getItem('chelsea_diary');
            } else {
                document.getElementById('login-error').classList.remove('hidden');
            }
        }
        document.getElementById('login-pass').addEventListener('keypress', function (e) { if (e.key === 'Enter') checkLogin(); });

        let zIndex = 50;
        function openWindow(id) { 
            const w = document.getElementById(id); 
            w.style.setProperty('display', 'flex', 'important'); 
            w.classList.add('active'); 
            w.style.zIndex = ++zIndex; 
        }
        function closeWindow(id) { 
            const w = document.getElementById(id); 
            w.style.setProperty('display', 'none', 'important'); 
            w.classList.remove('active'); 
        }
        function dragStart(e, id) { 
            let curWin = document.getElementById(id); let rect = curWin.getBoundingClientRect();
            let initX = e.clientX - rect.left; let initY = e.clientY - rect.top;
            let isDragging = true; curWin.style.zIndex = ++zIndex;

            function move(e) { if(isDragging) { e.preventDefault(); curWin.style.left = (e.clientX - initX) + 'px'; curWin.style.top = (e.clientY - initY) + 'px'; curWin.style.transform='none'; }}
            function stop() { isDragging = false; document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', stop); }
            
            document.addEventListener('mousemove', move);
            document.addEventListener('mouseup', stop);
        }
        document.querySelectorAll('.window').forEach(w => w.addEventListener('mousedown', () => w.style.zIndex = ++zIndex));

        function openPhoto(src, msg) { document.getElementById('viewer-img').src=src; document.getElementById('viewer-caption').innerText=msg; openWindow('win-image-viewer'); }
        function saveDiary() { localStorage.setItem('chelsea_diary', document.getElementById('diary-input').value); alert("Tersimpan!"); }
        function blowCandleGeneric() { document.getElementById('wish-text').classList.remove('hidden'); confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); }

        const c_data = Array(5).fill().map((_,i)=>({id:i+1, r: Math.floor(Math.random()*3), off:false}));
        function blowCandle(id) {
            if (id === 0) { blowCandleGeneric(); return; }
            const c = c_data[id-1]; if(c.off) return;
            const el = document.getElementById('c'+id);
            el.querySelector('.flame').classList.add('off'); el.querySelector('.smoke').classList.add('active');
            if(c.r > 0) setTimeout(() => { el.querySelector('.flame').classList.remove('off'); el.querySelector('.smoke').classList.remove('active'); c.r--; }, Math.random()*1000+800);
            else { c.off=true; if(c_data.every(x=>x.off)) { confetti(); document.getElementById('game-instruction').innerHTML="HAPPY BIRTHDAY! â¤ï¸"; document.getElementById('reset-candle-btn').classList.remove('hidden'); } }
        }
        function resetCandles() {
            c_data.forEach(c => { c.r = Math.floor(Math.random()*3); c.off=false; const el=document.getElementById('c'+c.id); el.querySelector('.flame').classList.remove('off'); el.querySelector('.smoke').classList.remove('active'); });
            document.getElementById('reset-candle-btn').classList.add('hidden'); document.getElementById('game-instruction').innerHTML = "Tiup/Klik api!";
        }
        function enableMic() {
            navigator.mediaDevices.getUserMedia({audio:true}).then(s => {
                const ctx = new (window.AudioContext||window.webkitAudioContext)(), analyser = ctx.createAnalyser(), mic = ctx.createMediaStreamSource(s), script = ctx.createScriptProcessor(2048,1,1);
                mic.connect(analyser); analyser.connect(script); script.connect(ctx.destination);
                script.onaudioprocess = () => {
                    const arr = new Uint8Array(analyser.frequencyBinCount); analyser.getByteFrequencyData(arr);
                    if((arr.reduce((a,b)=>a+b)/arr.length) > 40) { const lit = c_data.filter(c=>!c.off); if(lit.length) blowCandle(lit[Math.floor(Math.random()*lit.length)].id); }
                }; alert("Mic Aktif! Tiup!");
            }).catch(()=>alert("Mic Error. Klik aja!"));
        }
    </script>
</body>
</html>
